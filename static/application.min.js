const haste_document=function(){this.locked=!1};haste_document.prototype.htmlEscape=function(t){return t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")},haste_document.prototype.load=function(t,n,s){var i=this;$.ajax("/documents/"+t,{type:"get",dataType:"json",success:function(e){let o;i.locked=!0,i.key=t,i.data=e.data;try{o="txt"===s?{value:i.htmlEscape(e.data)}:s?hljs.highlight(s,e.data):hljs.highlightAuto(e.data)}catch(t){o=hljs.highlightAuto(e.data)}n({value:o.value,key:t,language:o.language||s,lineCount:e.data.split("\n").length})},error:function(){n(!1)}})},haste_document.prototype.save=function(o,n){if(this.locked)return!1;this.data=o;var s=this;$.ajax("/documents",{type:"post",data:o,dataType:"json",contentType:"text/plain; charset=utf-8",success:function(t){s.locked=!0,s.key=t.key;var e=hljs.highlightAuto(o);n(null,{value:e.value,key:t.key,language:e.language,lineCount:o.split("\n").length})},error:function(t){try{n($.parseJSON(t.responseText))}catch(t){n({message:"Something went wrong!"})}}})};const haste=function(t,e){this.appName=t,this.$textarea=$("textarea"),this.$box=$("#box"),this.$code=$("#box code"),this.$linenos=$("#linenos"),this.options=e,this.ignoreLast=!1,this.configureShortcuts(),this.configureButtons(),e.twitter||$("#box2 .twitter").hide()};haste.prototype.setTitle=function(t){document.title=t?this.appName+" - "+t:this.appName},haste.prototype.showMessage=function(t,e){const o=$('<li class="'+(e||"info")+'">'+t+"</li>");$("#messages").prepend(o),setTimeout(function(){o.slideUp("fast",function(){$(this).remove()})},3e3)},haste.prototype.lightKey=function(){this.configureKey(["new","save"])},haste.prototype.fullKey=function(){this.configureKey(["new","duplicate","twitter","raw"])},haste.prototype.configureKey=function(t){let e,o=0;$("#box2 .function").each(function(){for(e=$(this),o=0;o<t.length;o++)if(e.hasClass(t[o]))return e.addClass("enabled"),!0;e.removeClass("enabled")})},haste.prototype.newDocument=function(t){this.$box.hide(),this.doc=new haste_document,t||window.history.pushState(null,this.appName,"/"),this.setTitle(),this.lightKey(),this.$textarea.val("").show("fast",function(){this.focus()}),this.removeLineNumbers()},haste.extensionMap={rb:"ruby",py:"python",pl:"perl",php:"php",scala:"scala",go:"go",xml:"xml",html:"xml",htm:"xml",css:"css",js:"javascript",vbs:"vbscript",lua:"lua",pas:"delphi",java:"java",cpp:"cpp",cc:"cpp",m:"objectivec",vala:"vala",sql:"sql",sm:"smalltalk",lisp:"lisp",ini:"ini",diff:"diff",bash:"bash",sh:"bash",tex:"tex",erl:"erlang",hs:"haskell",md:"markdown",txt:"",coffee:"coffee",swift:"swift"},haste.prototype.lookupExtensionByType=function(t){for(const e in haste.extensionMap)if(haste.extensionMap[e]===t)return e;return t},haste.prototype.lookupTypeByExtension=function(t){return haste.extensionMap[t]||t},haste.prototype.goToLine=function(t){t=t||parseInt(window.location.hash.substr(2)),void 0!==this.line&&(this.line.removeClass("highlight"),$(".line[rel='L"+t+"']").removeClass("highlight")),this.line=$("#linenos span[rel='#L"+t+"'], .line[rel='L"+t+"']").addClass("highlight"),window.scrollTo(0,this.line.offset().top)},haste.prototype.addLineNumbers=function(e){let o="",n;for(let t=0;t<e;t++)n=(t+1).toString(),o+='<span rel="#L'+n+'">'+n+"</span><br/>";var s=this;$("#linenos").html(o),$("#linenos span").click(function(t){t.preventDefault(),s.ignoreLast=!0,window.location.hash=$(this).attr("rel"),s.goToLine($(this).attr("rel").substr(2))})},haste.prototype.removeLineNumbers=function(){$("#linenos").html("&gt;")},haste.prototype.setCode=function(t){const o=[];$.each(t.split("\n"),function(t,e){o[t]="<span class='line' rel='L"+t+"1'>"+e+"</span>\n"}),this.$code.html(o.join(""))},haste.prototype.loadDocument=function(t){var t=t.split(".",2),e=this;e.doc=new haste_document,e.doc.load(t[0],function(t){t?(e.setCode(t.value),e.setTitle(t.key),e.fullKey(),e.$textarea.val("").hide(),e.$box.show().focus(),e.addLineNumbers(t.lineCount),void 0!==window.location.hash&&""!==window.location.hash&&e.goToLine()):e.newDocument()},this.lookupTypeByExtension(t[1]))},haste.prototype.duplicateDocument=function(){var t;this.doc.locked&&(t=this.doc.data,this.newDocument(),this.$textarea.val(t))},haste.prototype.lockDocument=function(){var o=this;this.doc.save(this.$textarea.val(),function(t,e){if(t)o.showMessage(t.message,"error");else if(e){o.setCode(e.value),o.setTitle(e.key);let t="/"+e.key;e.language&&(t+="."+o.lookupExtensionByType(e.language)),window.history.pushState(null,o.appName+"-"+e.key,t),o.fullKey(),o.$textarea.val("").hide(),o.$box.show().focus(),o.addLineNumbers(e.lineCount)}})},haste.prototype.configureButtons=function(){var e=this;this.buttons=[{$where:$("#box2 .save"),label:"Save",shortcutDescription:"control + s",shortcut:function(t){return t.ctrlKey&&83===t.keyCode},action:function(){""!==e.$textarea.val().replace(/^\s+|\s+$/g,"")&&e.lockDocument()}},{$where:$("#box2 .new"),label:"New",shortcut:function(t){return t.ctrlKey&&78===t.keyCode},shortcutDescription:"control + n",action:function(){e.newDocument(!e.doc.key)}},{$where:$("#box2 .duplicate"),label:"Duplicate & Edit",shortcut:function(t){return e.doc.locked&&t.ctrlKey&&68===t.keyCode},shortcutDescription:"control + d",action:function(){e.duplicateDocument()}},{$where:$("#box2 .raw"),label:"Just Text",shortcut:function(t){return t.ctrlKey&&t.shiftKey&&82===t.keyCode},shortcutDescription:"control + shift + r",action:function(){window.location.href="/raw/"+e.doc.key}},{$where:$("#box2 .twitter"),label:"Twitter",shortcut:function(t){return e.options.twitter&&e.doc.locked&&t.shiftKey&&t.ctrlKey&&84==t.keyCode},shortcutDescription:"control + shift + t",action:function(){window.open("https://twitter.com/share?url="+encodeURI(window.location.href))}}];for(let t=0;t<this.buttons.length;t++)this.configureButton(this.buttons[t])},haste.prototype.configureButton=function(e){e.$where.click(function(t){t.preventDefault(),!e.clickDisabled&&$(this).hasClass("enabled")&&e.action()}),e.$where.mouseenter(function(){$("#box3 .label").text(e.label),$("#box3 .shortcut").text(e.shortcutDescription||""),$("#box3").show(),$(this).append($("#pointer").remove().show())}),e.$where.mouseleave(function(){$("#box3").hide(),$("#pointer").hide()})},haste.prototype.configureShortcuts=function(){var n=this;$(document.body).keydown(function(e){let o;for(let t=0;t<n.buttons.length;t++)if(o=n.buttons[t],o.shortcut&&o.shortcut(e))return e.preventDefault(),void o.action()})},$(function(){$("textarea").keydown(function(t){if(9===t.keyCode){t.preventDefault();var e,o,n="  ";if(document.selection){this.focus();const s=document.selection.createRange();s.text=n,this.focus()}else this.selectionStart||"0"===this.selectionStart?(e=this.selectionStart,o=this.selectionEnd,t=this.scrollTop,this.value=this.value.substring(0,e)+n+this.value.substring(o,this.value.length),this.focus(),this.selectionStart=e+n.length,this.selectionEnd=e+n.length,this.scrollTop=t):(this.value+=n,this.focus())}})});